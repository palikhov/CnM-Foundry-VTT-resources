This macro requires Item Macro along with Midi-qol. 

When you click on Sneak Attack, it checks for several things based on the previous weapon attack:

Gets previous target.
Gets previous damage type used.
Checks for Critical Hit
Checks for Disadvantage

Modules Required
Midi-Qol
Item Macro (optional)

Updates
2/7/21 : Updated for newest version of Midi-qol plus added disadvantage check.
2/8/21 : Updated cleaner method to grab history.
2/21/21: Found a better method to check for Dice so Nice.
3/17/21: Updated for newest Midi-qol.
4/2/21 Fixed Midi-Qol targeting
4/4/21: Slimmed up code.
4/13/21: Updated for latest Midi-qol
6/11/21: Updated for 8.x